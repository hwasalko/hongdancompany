<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hongdan.auto.blog">

    
	<insert id="com.hongdan.auto.blog.insertBlog"  parameterType="java.util.Map" >
	    INSERT INTO TB_BLOG(
	    	BLOG_SEQ,
  			TITLE,
  			CONTENTS,
  			REG_DDTM,
  			REG_ID,
  			DEL_YN,
  			TAGS
	    )
		SELECT 
			(IFNULL(MAX(BLOG_SEQ), 0) +1) BLOG_SEQ,
			#{title},
			#{contents},
			DATE_FORMAT(now(), '%Y%m%d%H%i%s'),
			'hongdan',
			'N',
			#{tags}
		FROM TB_BLOG
	</insert>
	
	<select id="com.hongdan.auto.blog.getBlogList" resultType="java.util.Map">
	    SELECT
	        BLOG_SEQ,
  			TITLE,
  			CONTENTS,
  			DATE_FORMAT(REG_DDTM, '%Y-%m-%d %H:%i:%s') REG_DDTM,
  			REG_ID,
  			DEL_YN,
  			REPLACE(TAGS, ' ', '') TAGS
	    FROM TB_BLOG
	    WHERE DEL_YN = 'N'
				    <if test = "sarchWord != null">
						AND TITLE LIKE CONCAT('%', #{sarchWord}, '%') 
					</if>
	    ORDER BY BLOG_SEQ DESC
	    LIMIT  ${currentPageNo} , ${pageSize}
	</select>
	
	<select id="com.hongdan.auto.blog.getBlogListTotalCount" resultType="integer">
	    SELECT COUNT(*) TOTAL_CNT
	    FROM TB_BLOG
	    WHERE DEL_YN = 'N'
	    			<if test = "sarchWord != null">
						AND TITLE LIKE CONCAT('%', #{sarchWord}, '%') 
					</if>
	</select>
	
	<select id="com.hongdan.auto.blog.getBlogView" parameterType="String"  resultType="java.util.Map">
	    SELECT
	        BLOG_SEQ,
  			TITLE,
  			CONTENTS,
  			DATE_FORMAT(REG_DDTM, '%Y-%m-%d %H:%i:%s') REG_DDTM,
  			REG_ID,
  			DEL_YN,
  			TAGS,
  			REPLACE(TAGS, ' ', '') TAGS_TRIM
	    FROM TB_BLOG
	    WHERE
	    	DEL_YN = 'N' 
	    	AND BLOG_SEQ = #{blog_seq}	    	
	    
	</select>
	
	
	<update id="com.hongdan.auto.blog.deleteBlog"  parameterType="java.util.Map" >
	    UPDATE TB_BLOG
  		SET DEL_YN = 'Y'
  		WHERE BLOG_SEQ = #{blog_seq}
	</update>
	
	<update id="com.hongdan.auto.blog.updateBlog"  parameterType="java.util.Map" >
	    UPDATE TB_BLOG
  		SET TITLE = #{title},
  			  CONTENTS = #{contents},
  			  TAGS = #{tags},
  			  UPDATE_DDTM = DATE_FORMAT(now(), '%Y%m%d%H%i%s')
  		WHERE BLOG_SEQ = #{blog_seq}
	</update>
	
	<select id="com.hongdan.auto.blog.getBlogTagsAll"  resultType="java.util.Map">
		SELECT DISTINCT REPLACE(TAGS, ' ', '') TAGS 
		FROM TB_BLOG
		WHERE LENGTH(TAGS) > 0
				AND DEL_YN = 'N' 
	</select>

    
</mapper>